<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Grim Castle — Level 01</title>
<style>
  :root{
    --brand-yellow:#ffd32a; --brand-red:#e53935; --brand-purple:#7a3bd1;
    --ink:#111; --bg:#fff8e6; --panel:#ffffff; --shadow:0 10px 30px rgba(0,0,0,.08);
    --green:#2eb85c;
  }
  html,body{height:100%}
  body{
    margin:0; background: radial-gradient(120% 120% at 50% 0%, var(--bg) 0%, #fff 60%);
    color:var(--ink); font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,"Helvetica Neue",sans-serif;
    -webkit-font-smoothing:antialiased;
    touch-action: manipulation;
  }
  .app{ min-height:100%; display:flex; align-items:center; justify-content:center; }
  .frame{ width:100%; max-width:560px; min-height:100dvh; display:flex; flex-direction:column; padding:16px 14px 24px; box-sizing:border-box; }

  /* Top / brand */
  .brand{ font-weight:800; letter-spacing:.3px; display:flex; gap:8px; align-items:center; }
  .brand .mark{ width:26px; height:26px; border-radius:8px; background:linear-gradient(180deg,var(--brand-yellow),#ffc400); box-shadow:0 2px 0 rgba(0,0,0,.08) inset, 0 1px 4px rgba(0,0,0,.08); position:relative; overflow:hidden; }
  .brand .mark::after{ content:""; position:absolute; inset:4px; border-radius:6px; background:var(--brand-red); transform:skewX(-10deg); mask: radial-gradient(8px 8px at 50% 85%, transparent 8px, #000 8px); }
  .hud{ display:flex; align-items:center; justify-content:space-between; }

  /* Intro card */
  .panel{ flex:1; display:flex; align-items:center; justify-content:center; position:relative; }
  .card{
    width:100%; border-radius:18px; padding:22px 18px; background:var(--panel); box-shadow:var(--shadow);
    display:flex; flex-direction:column; align-items:center; gap:14px; text-align:center;
    transform:translateY(10px); opacity:0; animation:pop .45s ease forwards;
  }
  .art{ width:110px; height:110px; }
  .line{ font-size:1.15rem; line-height:1.35; font-weight:650; }
  .hint{ font-size:.9rem; opacity:.7 }
  .controls{ display:flex; width:100%; justify-content:space-between; gap:10px; margin-top:8px; }
  button{ appearance:none; border:none; border-radius:14px; padding:14px 16px; font-weight:750; font-size:1rem; cursor:pointer; box-shadow:0 6px 16px rgba(0,0,0,.09); }
  .ghost{ background:transparent; border:2px solid rgba(0,0,0,.1) }
  .primary{ background:linear-gradient(180deg, var(--brand-yellow), #ffc400); }

  .progress{ height:6px; width:100%; background:rgba(0,0,0,.06); border-radius:999px; overflow:hidden; margin:10px 0 0; }
  .bar{ height:100%; width:0%; background:var(--brand-red); transition:width .25s ease }
  @keyframes pop{ from{ transform:translateY(8px) scale(.98); opacity:0 } to{ transform:translateY(0) scale(1); opacity:1 } }
  @media (prefers-reduced-motion: reduce){ .card{ animation:none; opacity:1; transform:none } .bar{ transition:none } }

  /* Level canvas */
  .scene{
    position:relative; width:100%; aspect-ratio:9/16; max-height:calc(100dvh - 140px);
    background:#111; border-radius:18px; overflow:hidden; box-shadow:var(--shadow);
  }
  .scene .bg{ position:absolute; inset:0; background:radial-gradient(80% 50% at 50% 0%, #1b1b1b 0%, #0c0c0c 60%); }

  .gate{ position:absolute; inset:6% 10% 22% 10%; border-radius:10px; background:#262626; box-shadow: inset 0 0 0 2px #000; z-index:1; }
  .gateBar{ position:absolute; top:0; bottom:0; width:7px; background:#0b0b0b; border-radius:6px; }
  .gateBar:nth-child(1){ left:10% } .gateBar:nth-child(2){ left:24% } .gateBar:nth-child(3){ left:38% }
  .gateBar:nth-child(4){ left:52% } .gateBar:nth-child(5){ left:66% } .gateBar:nth-child(6){ left:80% }
  .gate.open { animation: gateFade .6s ease forwards; }
  @keyframes gateFade { to { opacity:0; transform:translateY(6px); } }

  .floor{ position:absolute; left:0; right:0; bottom:0; height:22%; background:linear-gradient(#2a2a2a, #1c1c1c); z-index:0; }

  .screwdriver{
    position:absolute; left:20%; bottom:14%; width:26%; aspect-ratio:4/1; border-radius:6px;
    background:linear-gradient(90deg,#cfa05b,#d8a25a 40%, #9ea6b1 70%, #cfd6e3);
    box-shadow:0 6px 10px rgba(0,0,0,.35);
    transform:rotate(-6deg); cursor:pointer; z-index:3;
  }
  .screwdriver::after{ content:""; position:absolute; right:-6%; top:20%; width:14%; height:60%; background:#8d5b1f; border-radius:4px; }
  .screwdriverHint{ position:absolute; left:20%; bottom:14%; transform:translate(-10%,-140%); color:#fff; background:rgba(0,0,0,.45); padding:6px 8px; border-radius:8px; font-weight:700; font-size:.8rem; z-index:4; }

  .lock{
    position:absolute; right:14%; bottom:36%; width:22%; aspect-ratio:1/1.2; border-radius:10px;
    background:#5b5b5b; box-shadow: inset 0 -6px 0 rgba(0,0,0,.2), 0 8px 18px rgba(0,0,0,.35);
    display:flex; align-items:center; justify-content:center; cursor:not-allowed; z-index:2;
  }
  .lock.ready{ cursor:pointer; outline:3px solid #ffd54d; }
  .lock .keyhole{ width:30%; height:38%; background:#222; border-radius:10px; position:relative; }
  .lock .keyhole::before{ content:""; position:absolute; left:50%; top:-28%; width:75%; height:55%; transform:translateX(-50%); border-radius:999px; border:6px solid #222; background:transparent; }
  .lock.ok{ background:linear-gradient(180deg,#58d68d,#2eb85c); color:#fff; }

  .boy{
    position:absolute; left:10%; bottom:28%; width:22%; aspect-ratio:3/4; border-radius:10px;
    background:linear-gradient(#ffd9d7,#ffc4c1); box-shadow:0 6px 14px rgba(0,0,0,.35); z-index:2;
    animation:breathe 2.2s ease-in-out infinite;
  }
  @keyframes breathe{ 0%,100%{ transform:translateY(0) } 50%{ transform:translateY(-2px) } }
  .boy::after{ content:""; position:absolute; bottom:-6%; left:8%; width:84%; height:10%; border-radius:999px; background:rgba(0,0,0,.45); filter:blur(4px); }
  .boyHead{ position:absolute; top:-18%; left:22%; width:36%; aspect-ratio:1; background:#ffccbc; border-radius:50%; box-shadow:0 2px 0 rgba(0,0,0,.15) inset; }
  .eye{ position:absolute; top:38%; width:14%; height:14%; background:#222; border-radius:50%; }
  .eye.l{ left:24% } .eye.r{ right:24% }
  .youTag{ position:absolute; top:-26%; left:8%; background:#fff; padding:3px 6px; border-radius:8px; font-size:.7rem; font-weight:800; box-shadow:var(--shadow); }
  .bubble{ position:absolute; bottom:105%; left:10%; background:#fff; padding:6px 8px; border-radius:10px; font-weight:900; box-shadow:var(--shadow); display:none; }
  .bubble.show{ display:block; animation:pop .2s ease forwards; }

  /* Backpack */
  .backpack{
    display:flex; align-items:center; gap:8px; padding:8px 12px; border-radius:14px; background:#fff; box-shadow:var(--shadow);
    font-weight:700;
  }
  .bpicon{ width:22px; height:22px; border-radius:6px; background:linear-gradient(180deg,#ffd54d,#ffb300); position:relative; }
  .bpicon::after{ content:""; position:absolute; inset:3px; border-radius:4px; background:var(--brand-red,.red); opacity:.9 }
  .bpitems{ display:flex; gap:6px; margin-left:6px; }
  .bpitem{ width:22px; height:10px; border-radius:4px; background:linear-gradient(90deg,#cfa05b,#d8a25a 40%, #9ea6b1 70%, #cfd6e3); box-shadow:0 1px 3px rgba(0,0,0,.15); }

  .toast{
    margin-left:auto; margin-right:auto; padding:10px 12px; background:#fff; border-radius:14px; box-shadow:var(--shadow);
    font-weight:600; font-size:.95rem; opacity:.95;
  }

  /* Lockpick modal */
  .overlay{ position:absolute; inset:0; background:rgba(0,0,0,.55); display:none; align-items:center; justify-content:center; z-index:10; }
  .overlay.open{ display:flex; }
  .modal{
    width:min(520px,92vw); border-radius:18px; background:#fff; box-shadow:0 20px 50px rgba(0,0,0,.4);
    padding:20px; display:flex; flex-direction:column; gap:12px; text-align:center; animation:pop .25s ease forwards;
  }
  .meter{ height:14px; width:100%; border-radius:12px; background:#eee; overflow:hidden; box-shadow:inset 0 1px 3px rgba(0,0,0,.1); }
  .meter .fill{ height:100%; width:0%; background:linear-gradient(90deg,var(--brand-red),#ff6f00); transition:width .08s linear; }
  .tapzone{
    user-select:none; -webkit-user-select:none;
    touch-action: manipulation;
    display:flex; align-items:center; justify-content:center; height:180px; border-radius:16px; background:#fff6e2; box-shadow:inset 0 0 0 3px #ffe08a;
    font-weight:900; font-size:1.2rem;
  }

  /* End screen (greyed) */
  .endOverlay{ position:absolute; inset:0; background:rgba(0,0,0,.65); display:none; align-items:center; justify-content:center; z-index:20; }
  .endOverlay.show{ display:flex; }
  .endCard{ width:min(520px,92vw); border-radius:18px; background:#fff; box-shadow:0 20px 50px rgba(0,0,0,.5); padding:20px; text-align:center; }
</style>
</head>
<body>
<div class="app">
  <div class="frame" role="dialog" aria-label="Game">
    <!-- Top / Brand -->
    <div class="hud">
      <div class="brand" aria-hidden="true">
        <div class="mark"></div><div>MONDOBITES</div>
      </div>
      <div class="backpack" id="backpack" style="display:none" aria-label="Backpack">
        <div class="bpicon"></div>
        <div>Bag</div>
        <div class="bpitems" id="bpItems"></div>
      </div>
    </div>

    <!-- Panel hosts Intro or Scene -->
    <div class="panel" id="panel">
      <!-- INTRO CARD -->
      <div class="card" id="card">
        <svg class="art" viewBox="0 0 120 120" id="art" aria-hidden="true"></svg>
        <div class="line" id="line">…</div>
        <div class="hint" id="hint">Tap to continue</div>
        <div class="progress" aria-hidden="true"><div class="bar" id="bar"></div></div>
      </div>
    </div>

    <div class="controls" id="introControls">
      <button class="ghost" id="skipBtn" aria-label="Skip intro">Skip</button>
      <button class="primary" id="nextBtn" aria-label="Next">Next</button>
    </div>
  </div>
</div>

<script>
/* -------------------------
   INTRO: slides & flow
--------------------------*/
const $panel = document.getElementById('panel');
const $art = document.getElementById('art');
const $line = document.getElementById('line');
const $bar = document.getElementById('bar');
const $next = document.getElementById('nextBtn');
const $skip = document.getElementById('skipBtn');
const $card = document.getElementById('card');
const $introControls = document.getElementById('introControls');
const $backpack = document.getElementById('backpack');
const $bpItems = document.getElementById('bpItems');

const slides = [
  { text:"A little boy visits the world-famous burger place.", svg: burgerShop() },
  { text:"He buys a purple shake. Looks… legendary.", svg: shakeCup() },
  { text:"A few sips later—dizzy. He hurries home and crashes on the sofa.", svg: sofaNap() },
  { text:"He wakes up… in a cage under a strange castle.", svg: cageCastle() },
  { text:"Something glints on the floor. A screwdriver.", svg: screwdriverSvg() },
  { text:"Escape starts now.", svg: startLock(), cta:"Start Game" }
];

let slideIndex = 0;
renderSlide(slideIndex);

$next.addEventListener('click', nextSlide);
$skip.addEventListener('click', skipIntro);
document.addEventListener('keydown', e=>{
  if (e.key === 'Enter' || e.key === ' ') nextSlide();
  if (e.key === 'Escape') skipIntro();
});
$card.addEventListener('click', (e)=>{
  if (e.target.tagName.toLowerCase() === 'button') return;
  nextSlide();
});

function renderSlide(idx){
  const s = slides[idx];
  $art.innerHTML = s.svg;
  $line.textContent = s.text;
  $bar.style.width = ((idx+1)/slides.length*100).toFixed(1) + '%';
  $next.textContent = s.cta || "Next";
  $card.style.animation = 'none'; void $card.offsetWidth; $card.style.animation = '';
}
function nextSlide(){
  if (slideIndex < slides.length - 1){ slideIndex++; renderSlide(slideIndex); }
  else { startGame(); }
}
function skipIntro(){ slideIndex = slides.length - 1; renderSlide(slideIndex); }
function startGame(){
  $introControls.remove();
  $panel.innerHTML = levelSceneHtml();
  $backpack.style.display = 'flex';
  setupLevel01();
}

/* -------------------------
   LEVEL 01
--------------------------*/
function levelSceneHtml(){
  return `
  <div class="scene" id="scene" aria-label="Level 01: Escape the Cage">
    <div class="bg"></div>
    <div class="floor"></div>

    <div class="gate" id="gate" aria-hidden="true">
      <div class="gateBar"></div><div class="gateBar"></div><div class="gateBar"></div>
      <div class="gateBar"></div><div class="gateBar"></div><div class="gateBar"></div>
    </div>

    <div class="boy" id="boy" title="You">
      <div class="boyHead"></div>
      <div class="eye l"></div><div class="eye r"></div>
      <div class="youTag">You</div>
      <div class="bubble" id="bubble">Hurra!</div>
    </div>

    <div class="screwdriver" id="screwdriver" title="Screwdriver"></div>
    <div class="screwdriverHint" id="screwdriverHint">Tap to pick</div>

    <div class="lock" id="lock" title="Cage Lock"><div class="keyhole"></div></div>

    <!-- Lockpick modal (z-index:10) -->
    <div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-label="Lockpick">
      <div class="modal">
        <div style="font-weight:900; font-size:1.1rem;">Unlock the cage!</div>
        <div style="opacity:.75">Tap fast. Slow taps are erased.</div>
        <div class="meter"><div class="fill" id="meterFill"></div></div>
        <div class="tapzone" id="tapZone">TAP! TAP! TAP!</div>
        <button class="ghost" id="cancelPick">Cancel</button>
      </div>
    </div>

    <!-- End screen (z-index:20; always above) -->
    <div class="endOverlay" id="endOverlay">
      <div class="endCard">
        <div style="font-weight:900; font-size:1.25rem; margin-bottom:6px;">Level Complete!</div>
        <div id="timeResult" style="opacity:.8; margin-bottom:14px;">Time: – s</div>
        <button class="primary" id="restartBtn">Restart</button>
      </div>
    </div>
  </div>`;
}

const game = {
  inventory: new Set(),
  state: 'explore', // 'explore' | 'lockpick' | 'won'
  progress: 0,
  target: 30,
  decayPerSecond: 3.6,
  lastTick: 0,
  raf: null,
  startTime: 0,
  endTime: 0
};

function setupLevel01(){
  const gate = document.getElementById('gate');
  const lock = document.getElementById('lock');
  const screwdriver = document.getElementById('screwdriver');
  const screwdriverHint = document.getElementById('screwdriverHint');
  const bubble = document.getElementById('bubble');
  const boy = document.getElementById('boy');

  const overlay = document.getElementById('overlay');
  const tapZone = document.getElementById('tapZone');
  const fill = document.getElementById('meterFill');
  const cancelBtn = document.getElementById('cancelPick');

  const endOverlay = document.getElementById('endOverlay');
  const restartBtn = document.getElementById('restartBtn');
  const timeResult = document.getElementById('timeResult');

  game.inventory.clear();
  game.state = 'explore';
  game.progress = 0;
  renderBackpack();
  toast("Pick up the screwdriver.");
  game.startTime = performance.now();

  function pickup(e){
    e.preventDefault?.();
    if (game.inventory.has('screwdriver')) return;
    game.inventory.add('screwdriver');
    renderBackpack();
    screwdriverHint.remove();
    screwdriver.style.transition = 'transform .25s ease, opacity .25s ease';
    screwdriver.style.transform = 'translateY(8px) scale(.9)';
    screwdriver.style.opacity = '0';
    setTimeout(()=> screwdriver.remove(), 260);
    lock.classList.add('ready');
    lock.style.cursor = 'pointer';
    toast("Tap the lock to use the screwdriver.");
  }
  screwdriver.addEventListener('click', pickup);
  screwdriver.addEventListener('touchstart', pickup, {passive:true});

  function tryLockpick(e){
    e.preventDefault?.();
    if (!game.inventory.has('screwdriver')) { bounce(lock); toast("You need a tool…"); return; }
    if (game.state === 'won') return;
    overlay.classList.add('open');
    game.state = 'lockpick';
    game.progress = Math.max(0, Math.floor(game.progress));
    fill.style.width = pct(game.progress, game.target);
    game.lastTick = performance.now();
    loop();
  }
  lock.addEventListener('click', tryLockpick);
  lock.addEventListener('touchstart', tryLockpick, {passive:true});

  function loop(now){
    if (game.state !== 'lockpick') return;
    game.raf = requestAnimationFrame(loop);
    const t = now ?? performance.now();
    const dt = Math.min(0.2, (t - game.lastTick)/1000);
    game.lastTick = t;

    game.progress = Math.max(0, game.progress - game.decayPerSecond * dt);
    fill.style.width = pct(game.progress, game.target);

    if (game.progress >= game.target){
      win();
    }
  }

  function handleTap(e){
    e.preventDefault?.();
    game.progress = Math.min(game.target, game.progress + 1);
    fill.style.width = pct(game.progress, game.target);
    tapZone.animate([{transform:'scale(1)'},{transform:'scale(0.96)'},{transform:'scale(1)'}], {duration:120});
    if (game.progress >= game.target){ win(); }
  }
  tapZone.addEventListener('click', handleTap);
  tapZone.addEventListener('touchstart', handleTap, {passive:false});

  cancelBtn.addEventListener('click', ()=>{
    cancelAnimationFrame(game.raf);
    overlay.classList.remove('open');
    game.state = 'explore';
  });

  function win(){
    cancelAnimationFrame(game.raf);
    overlay.classList.remove('open');

    // 1) Visualize open lock
    lock.classList.remove('ready');
    lock.classList.add('ok');
    lock.innerHTML = '<div style="font-weight:900;">OPEN</div>';

    // 2) Gate fades
    gate.classList.add('open');

    // 3) Happy boy rushes out with "Hurra!"
    bubble.classList.add('show');
    boy.style.animation = 'none';
    boy.animate(
      [{transform:'translateX(0)'},
       {transform:'translateX(40vw)'}],
      {duration:2500, easing:'cubic-bezier(.2,.8,.2,1)', fill:'forwards'}
    );

    // 4) Measure time and show end screen
    game.state = 'won';
    game.endTime = performance.now();
    const secs = ((game.endTime - game.startTime)/1000).toFixed(2);
    timeResult.textContent = `Time: ${secs} s`;

    // delay a moment so the rush-out animation is visible
    setTimeout(()=> endOverlay.classList.add('show'), 2550);
  }

  restartBtn.addEventListener('click', ()=>{
    // Rebuild scene cleanly
    $panel.innerHTML = levelSceneHtml();
    setupLevel01();
  });

  // helpers
  function pct(v,m){ return (100*v/m).toFixed(1)+'%'; }
  function bounce(el){ el.animate([{transform:'translateY(0)'},{transform:'translateY(-2px)'},{transform:'translateY(0)'}], {duration:140}); }
}

/* Backpack rendering */
function renderBackpack(){
  $bpItems.innerHTML = '';
  for (const item of game.inventory){
    if (item === 'screwdriver'){
      const el = document.createElement('div'); el.className='bpitem'; el.title='Screwdriver'; $bpItems.appendChild(el);
    }
  }
}

/* Tiny toast (under brand) */
let toastEl;
function toast(msg){
  if (!toastEl){
    toastEl = document.createElement('div'); toastEl.className='toast'; document.querySelector('.frame').insertBefore(toastEl, document.querySelector('.panel'));
  }
  toastEl.textContent = msg;
  toastEl.style.opacity = '0';
  toastEl.animate([{opacity:0, transform:'translateY(-6px)'},{opacity:.95, transform:'translateY(0)'}], {duration:180, fill:'forwards'});
  setTimeout(()=> toastEl.animate([{opacity:.95},{opacity:0}], {duration:350, fill:'forwards'}), 2000);
}

/* -------------------------
   SVG makers for Intro
--------------------------*/
// === Drop-in: richer illustrations with the boy in each ===
function burgerShop(){
  return `
<svg viewBox="0 0 360 240" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="sky" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0" stop-color="#fff8e6"/>
      <stop offset="1" stop-color="#fff"/>
    </linearGradient>
    <linearGradient id="sunGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0" stop-color="#ffd32a"/>
      <stop offset="1" stop-color="#ffb300"/>
    </linearGradient>
    <linearGradient id="shopRed" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0" stop-color="#ff5a4e"/>
      <stop offset="1" stop-color="#e53935"/>
    </linearGradient>
    <filter id="softShadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="6" stdDeviation="6" flood-opacity=".25"/>
    </filter>
  </defs>

  <!-- sky + sun -->
  <rect width="360" height="240" fill="url(#sky)"/>
  <circle cx="310" cy="42" r="22" fill="url(#sunGrad)" opacity=".9"/>

  <!-- restaurant box -->
  <g filter="url(#softShadow)">
    <rect x="40" y="70" width="280" height="120" rx="16" fill="url(#shopRed)"/>
    <rect x="60" y="92" width="240" height="54" rx="10" fill="#fff" opacity=".95"/>
    <!-- awning -->
    <g transform="translate(80,62)">
      <rect x="0" y="0" width="200" height="22" rx="8" fill="#ffd32a"/>
      ${Array.from({length:10}).map((_,i)=>`
        <path d="M${i*20} 22 h20 a10 10 0 0 1 -20 0z" fill="#fff" opacity="${0.6+0.05*(i%2)}"/>`).join('')}
    </g>
    <!-- windows hint -->
    <rect x="75" y="98" width="70" height="40" rx="6" fill="#e9eef7"/>
    <rect x="155" y="98" width="70" height="40" rx="6" fill="#e9eef7"/>
    <rect x="235" y="98" width="50" height="40" rx="6" fill="#e9eef7"/>
  </g>

  <!-- little boy, looking at shop -->
  ${boySvg(60,165,1)}
  <text x="88" y="158" font-size="12" font-weight="700" fill="#222" opacity=".75">“I want a shake.”</text>

  <!-- foreground path -->
  <rect x="0" y="200" width="360" height="40" fill="#f1f1f1"/>
</svg>`;
}

function shakeCup(){
  return `
<svg viewBox="0 0 360 240" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="bg2" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0" stop-color="#f9f6ff"/>
      <stop offset="1" stop-color="#ffffff"/>
    </linearGradient>
    <linearGradient id="shakeBody" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0" stop-color="#a98bf2"/>
      <stop offset="1" stop-color="#7a3bd1"/>
    </linearGradient>
    <filter id="cupShadow">
      <feDropShadow dx="0" dy="6" stdDeviation="5" flood-opacity=".25"/>
    </filter>
  </defs>

  <rect width="360" height="240" fill="url(#bg2)"/>

  <!-- table -->
  <rect x="0" y="180" width="360" height="60" fill="#f2e9da"/>

  <!-- boy holding cup -->
  ${boySvg(90,155,1, true)}
  <!-- oversized shiny cup -->
  <g filter="url(#cupShadow)" transform="translate(200,70)">
    <rect x="8" y="0" width="40" height="10" rx="3" fill="#d1d1d1"/>
    <rect x="26" y="-26" width="4" height="36" rx="2" fill="#c7c7c7"/>
    <path d="M0 10 h64 l-10 90 H10 L0 10z" fill="url(#shakeBody)" stroke="#5a2bb0" stroke-width="2"/>
    <rect x="-6" y="6" width="76" height="12" rx="6" fill="#ffffff" opacity=".95"/>
    <!-- gloss -->
    <path d="M46 30 q-8 38 -28 56" stroke="rgba(255,255,255,.45)" stroke-width="6" fill="none" stroke-linecap="round"/>
  </g>

  <text x="24" y="40" font-size="18" font-weight="800" fill="#2b2b2b">Legendary Purple</text>
  <text x="24" y="60" font-size="12" fill="#6b6b6b">…just one sip won’t hurt, right?</text>
</svg>`;
}

function sofaNap(){
  return `
<svg viewBox="0 0 360 240" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="roomWall" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0" stop-color="#f8f1ec"/>
      <stop offset="1" stop-color="#fefefe"/>
    </linearGradient>
    <linearGradient id="sofa" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0" stop-color="#ff8f88"/>
      <stop offset="1" stop-color="#e46a64"/>
    </linearGradient>
    <filter id="soft">
      <feDropShadow dx="0" dy="8" stdDeviation="8" flood-opacity=".18"/>
    </filter>
  </defs>

  <rect width="360" height="240" fill="url(#roomWall)"/>
  <!-- picture frame -->
  <rect x="260" y="24" width="70" height="50" rx="6" fill="#fff" stroke="#ddd"/>
  <circle cx="295" cy="50" r="18" fill="#ffd54d" opacity=".9"/>

  <!-- sofa -->
  <g filter="url(#soft)">
    <rect x="40" y="110" width="280" height="70" rx="16" fill="url(#sofa)"/>
    <rect x="30" y="168" width="300" height="30" rx="14" fill="#d75a54"/>
    <rect x="60" y="120" width="90" height="40" rx="8" fill="#ffd9d7"/>
    <rect x="210" y="120" width="90" height="40" rx="8" fill="#ffd9d7"/>
  </g>

  <!-- sleeping boy -->
  ${boySvg(90,150,1)}
  <text x="140" y="115" font-size="16" fill="#7a7a7a">Z z z…</text>
</svg>`;
}

function cageCastle(){
  return `
<svg viewBox="0 0 360 240" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="dungeon" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0" stop-color="#1e1e1e"/>
      <stop offset="1" stop-color="#0e0e0e"/>
    </linearGradient>
    <filter id="barsShadow">
      <feDropShadow dx="0" dy="4" stdDeviation="3" flood-opacity=".5"/>
    </filter>
    <linearGradient id="lamp" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0" stop-color="#ffe082"/>
      <stop offset="1" stop-color="rgba(255,224,130,0)"/>
    </linearGradient>
  </defs>

  <rect width="360" height="240" fill="url(#dungeon)"/>
  <!-- lamp glow -->
  <ellipse cx="300" cy="40" rx="60" ry="28" fill="url(#lamp)" opacity=".6"/>
  <rect x="50" y="40" width="260" height="150" rx="10" fill="#2b2b2b" stroke="#000"/>
  <g filter="url(#barsShadow)">
    ${[0,1,2,3,4,5,6].map(i=>`<rect x="${70+i*36}" y="40" width="8" height="150" rx="4" fill="#0b0b0b"/>`).join('')}
  </g>
  <!-- lock plate -->
  <rect x="250" y="110" width="40" height="40" rx="8" fill="#666"/>
  <path d="M270 133 v-10 a9 9 0 0 1 18 0 v10" stroke="#222" stroke-width="5" fill="none" stroke-linecap="round"/>
  <rect x="265" y="133" width="18" height="12" rx="3" fill="#222"/>

  <!-- boy inside cage -->
  ${boySvg(100,150,1)}
</svg>`;
}

function screwdriverSvg(){
  return `
<svg viewBox="0 0 360 240" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="bg4" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0" stop-color="#191919"/>
      <stop offset="1" stop-color="#0f0f0f"/>
    </linearGradient>
    <filter id="glow">
      <feGaussianBlur stdDeviation="3" result="b"/>
      <feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
  </defs>
  <rect width="360" height="240" fill="url(#bg4)"/>
  ${boySvg(70,160,1)}
  <g transform="translate(180,150) rotate(-10)" filter="url(#glow)">
    <rect x="-120" y="0" width="180" height="12" rx="6" fill="#d8a25a"/>
    <rect x="50" y="-2" width="18" height="16" rx="4" fill="#8d5b1f"/>
    <rect x="-134" y="2" width="18" height="8" rx="2" fill="#bfc6d1"/>
    <rect x="-150" y="4" width="14" height="6" rx="2" fill="#d9e1ee"/>
  </g>
  <text x="190" y="144" font-size="12" fill="#ffd54d">A screwdriver!</text>
</svg>`;
}

function startLock(){
  return `
<svg viewBox="0 0 360 240" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <radialGradient id="pulse" cx="50%" cy="50%" r="60%">
      <stop offset="0" stop-color="#fff3c4"/>
      <stop offset="1" stop-color="#ffd32a"/>
    </radialGradient>
    <filter id="boldShadow">
      <feDropShadow dx="0" dy="6" stdDeviation="8" flood-opacity=".35"/>
    </filter>
  </defs>
  <rect width="360" height="240" fill="#fffdf5"/>
  <g filter="url(#boldShadow)" transform="translate(110,50)">
    <circle cx="70" cy="70" r="70" fill="url(#pulse)"/>
    <rect x="50" y="80" width="40" height="40" rx="6" fill="#333" />
    <path d="M44 78 v-18 a20 20 0 0 1 40 0 v18" stroke="#333" stroke-width="10" fill="none" stroke-linecap="round"/>
  </g>
  ${boySvg(40,170,.9)}
  <text x="24" y="32" font-size="18" font-weight="800" fill="#2b2b2b">Escape starts now</text>
</svg>`;
}

/* --- helper: consistent boy character (body, head, face) ---
   px, py: baseline position of feet-ish; scale: overall scale; holdCup: add little cup in hand */
function boySvg(px=80, py=160, scale=1, holdCup=false){
  const s = scale;
  const cup = holdCup ? `
    <g transform="translate(${px+42*s},${py-38*s}) scale(${0.6*s})">
      <rect x="0" y="-8" width="24" height="8" rx="2" fill="#dadada"/>
      <rect x="10" y="-24" width="4" height="16" rx="2" fill="#c7c7c7"/>
      <path d="M-6 -4 h36 l-6 40 H0 l-6 -40z" fill="#8f6cf0" stroke="#5a2bb0" stroke-width="2"/>
      <rect x="-9" y="-8" width="42" height="8" rx="4" fill="#fff"/>
    </g>` : '';
  return `
  <g transform="translate(${px},${py}) scale(${s})">
    <!-- shadow -->
    <ellipse cx="0" cy="8" rx="26" ry="8" fill="rgba(0,0,0,.35)" filter="url(#softShadow)"/>
    <!-- body -->
    <rect x="-18" y="-44" width="36" height="46" rx="10" fill="#ffd9d7" />
    <!-- head -->
    <circle cx="0" cy="-62" r="16" fill="#ffccbc"/>
    <path d="M-18 -68 q18 -16 36 0 v6 h-36z" fill="#3f3d56"/> <!-- hair -->
    <!-- eyes + smile -->
    <circle cx="-6" cy="-62" r="2.8" fill="#222"/>
    <circle cx="6" cy="-62" r="2.8" fill="#222"/>
    <path d="M-8 -56 q8 8 16 0" stroke="#222" stroke-width="2.5" fill="none" stroke-linecap="round"/>
    <!-- legs -->
    <rect x="-14" y="2" width="10" height="14" rx="3" fill="#3b3b3b"/>
    <rect x="4" y="2" width="10" height="14" rx="3" fill="#3b3b3b"/>
    <!-- arm -->
    <rect x="-24" y="-36" width="12" height="8" rx="4" fill="#ffccbc"/>
    <rect x="12" y="-36" width="12" height="8" rx="4" fill="#ffccbc"/>
    ${cup}
  </g>`;

}
</script>
</body>
</html>
